@model ClaimManagementHub.Models.Claim
@{
    ViewData["Title"] = "Submit Claim - ClaimFlow Pro";
    Layout = "_Layout"; // Add this line
}

<div class="min-h-screen bg-gradient-to-br from-gray-50 to-blue-50 py-8">
    <div class="max-w-4xl mx-auto px-6">
        <!-- Header -->
        <div class="text-center mb-8 slide-up">
            <div class="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-primary-500 to-primary-600 rounded-3xl shadow-2xl mb-4">
                <i class="fas fa-file-invoice text-white text-2xl"></i>
            </div>
            <h1 class="text-4xl font-bold text-gray-900 mb-3">Submit New Claim</h1>
            <p class="text-lg text-gray-600 max-w-2xl mx-auto">
                Fill in your claim details below. The system automatically calculates totals and applies smart validation.
            </p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Main Form -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-2xl shadow-2xl border border-gray-200/50 overflow-hidden slide-up">
                    <!-- Form Header -->
                    <div class="bg-gradient-to-r from-primary-500 to-primary-600 px-6 py-5">
                        <div class="flex items-center space-x-3">
                            <i class="fas fa-pen-to-square text-white text-xl"></i>
                            <h2 class="text-xl font-bold text-white">Claim Details</h2>
                        </div>
                    </div>

                    <!-- Form Content -->
                    <div class="p-6">
                        <form id="claimForm" method="post" action="@Url.Action("SubmitClaim", "Lecturer")" enctype="multipart/form-data" class="space-y-6">
                            @Html.AntiForgeryToken()

                            <!-- Lecturer Info -->
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center space-x-2">
                                        <i class="fas fa-user text-primary-600"></i>
                                        <span>Lecturer Name</span>
                                    </label>
                                    <input type="text" name="LecturerName" value="@User.Identity?.Name"
                                           class="w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all duration-300"
                                           placeholder="Your full name" readonly>
                                </div>
                                <div class="flex items-end">
                                    <div class="text-sm text-gray-500 bg-gray-100 px-3 py-2 rounded-lg w-full">
                                        <i class="fas fa-info-circle text-primary-600 mr-1"></i>
                                        Automatically filled from your profile
                                    </div>
                                </div>
                            </div>

                            <!-- Hours and Rate -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center space-x-2">
                                        <i class="fas fa-clock text-orange-600"></i>
                                        <span>Hours Worked</span>
                                    </label>
                                    <div class="relative">
                                        <input type="number" name="HoursWorked" step="0.25" min="0.25" max="100"
                                               class="w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all duration-300 pr-12"
                                               placeholder="0.0" required>
                                        <span class="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-500">hours</span>
                                    </div>
                                    <div class="text-xs text-gray-500 mt-1">Enter hours in 15-minute increments (0.25)</div>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center space-x-2">
                                        <i class="fas fa-money-bill-wave text-green-600"></i>
                                        <span>Hourly Rate</span>
                                    </label>
                                    <div class="relative">
                                        <span class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-500">R</span>
                                        <input type="number" name="HourlyRate" step="0.01" min="30" max="500"
                                               class="w-full px-10 py-3 bg-gray-50 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all duration-300"
                                               placeholder="0.00" required>
                                        <span class="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-500">/hr</span>
                                    </div>
                                    <div class="text-xs text-gray-500 mt-1">Standard rates: R30 - R500 per hour</div>
                                </div>
                            </div>

                            <!-- Real-time Calculation -->
                            <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-4 border-2 border-dashed border-blue-200">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <div class="text-sm font-semibold text-blue-700">Estimated Total</div>
                                        <div class="text-xs text-blue-600">Based on current inputs</div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-3xl font-bold text-blue-600">R<span id="totalAmount">0.00</span></div>
                                        <div class="text-xs text-blue-500" id="calculationText">0 hours × R0.00/hr</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Additional Notes -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center space-x-2">
                                    <i class="fas fa-sticky-note text-purple-600"></i>
                                    <span>Additional Notes</span>
                                </label>
                                <textarea name="AdditionalNotes" rows="4"
                                          class="w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all duration-300"
                                          placeholder="Describe the work performed, any special circumstances, or additional information that might help with approval..."></textarea>
                                <div class="text-xs text-gray-500 mt-1">Optional: Provide context for your claim</div>
                            </div>

                            <!-- File Upload -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center space-x-2">
                                    <i class="fas fa-paperclip text-gray-600"></i>
                                    <span>Supporting Documents</span>
                                </label>
                                <div class="border-2 border-dashed border-gray-300 rounded-xl p-6 text-center hover:border-primary-400 transition-all duration-300 bg-gray-50/50"
                                     id="dropZone">
                                    <i class="fas fa-cloud-upload-alt text-gray-400 text-3xl mb-3"></i>
                                    <p class="text-gray-600 mb-2 font-medium">Drag and drop files here</p>
                                    <p class="text-sm text-gray-500 mb-4">or click to browse your computer</p>
                                    <input type="file" name="upload" class="hidden" accept=".pdf,.docx,.xlsx,.jpg,.jpeg,.png" id="fileInput" />
                                    <button type="button" onclick="document.getElementById('fileInput').click()"
                                            class="bg-primary-500 text-white px-6 py-2 rounded-lg hover:bg-primary-600 transition-colors duration-300 font-semibold">
                                        Choose Files
                                    </button>
                                    <p class="text-xs text-gray-400 mt-3">Supports: PDF, DOCX, XLSX, JPG, PNG (Max: 5MB)</p>
                                </div>
                                <div id="fileList" class="mt-3 space-y-2 hidden">
                                    <!-- Selected files will appear here -->
                                </div>
                            </div>

                            <!-- Form Actions -->
                            <div class="flex flex-col sm:flex-row gap-4 pt-6 border-t border-gray-200">
                                <button type="button" onclick="clearForm()"
                                        class="flex-1 px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 hover:border-gray-400 transition-all duration-300 font-semibold">
                                    <i class="fas fa-eraser mr-2"></i>Clear Form
                                </button>
                                <button type="submit"
                                        class="flex-1 bg-gradient-to-br from-primary-500 to-primary-600 text-white py-3 px-6 rounded-xl font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-300 group">
                                    <span class="flex items-center justify-center space-x-2">
                                        <i class="fas fa-paper-plane group-hover:scale-110 transition-transform duration-300"></i>
                                        <span>Submit Claim</span>
                                    </span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Sidebar - Help & Information -->
            <div class="lg:col-span-1 space-y-6">
                <!-- Quick Help -->
                <div class="bg-white rounded-2xl shadow-xl border border-gray-200/50 p-6 slide-up" style="animation-delay: 0.1s">
                    <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center space-x-2">
                        <i class="fas fa-lightbulb text-yellow-500"></i>
                        <span>Quick Tips</span>
                    </h3>
                    <div class="space-y-3 text-sm">
                        <div class="flex items-start space-x-3 p-3 bg-blue-50 rounded-xl">
                            <i class="fas fa-calculator text-blue-600 mt-0.5"></i>
                            <span class="text-gray-700">Total amount is automatically calculated from hours × rate</span>
                        </div>
                        <div class="flex items-start space-x-3 p-3 bg-green-50 rounded-xl">
                            <i class="fas fa-bolt text-green-600 mt-0.5"></i>
                            <span class="text-gray-700">Small claims (≤ R1000) may be auto-approved</span>
                        </div>
                        <div class="flex items-start space-x-3 p-3 bg-purple-50 rounded-xl">
                            <i class="fas fa-robot text-purple-600 mt-0.5"></i>
                            <span class="text-gray-700">Smart validation checks for common issues</span>
                        </div>
                    </div>
                </div>

                <!-- Auto-Approval Info -->
                <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-2xl shadow-xl p-6 text-white slide-up" style="animation-delay: 0.2s">
                    <h3 class="text-lg font-bold mb-3 flex items-center space-x-2">
                        <i class="fas fa-rocket"></i>
                        <span>Auto-Approval</span>
                    </h3>
                    <p class="text-green-100 text-sm mb-4">
                        Claims under R1000 with standard hours are automatically approved for faster processing.
                    </p>
                    <div class="bg-white/20 rounded-lg p-3">
                        <div class="text-xs text-green-100">Current auto-approval threshold: <span class="font-bold">R1000</span></div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="bg-white rounded-2xl shadow-xl border border-gray-200/50 p-6 slide-up" style="animation-delay: 0.3s">
                    <h3 class="text-lg font-bold text-gray-900 mb-4">📈 Your Stats</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center p-3 bg-gray-50 rounded-xl">
                            <span class="text-sm text-gray-700">Claims This Month</span>
                            <span class="font-bold text-primary-600">0</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-gray-50 rounded-xl">
                            <span class="text-sm text-gray-700">Total Approved</span>
                            <span class="font-bold text-green-600">R0.00</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-gray-50 rounded-xl">
                            <span class="text-sm text-gray-700">Avg Processing</span>
                            <span class="font-bold text-blue-600">-</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Submit Claim page loaded');

            const hoursInput = document.querySelector('input[name="HoursWorked"]');
            const rateInput = document.querySelector('input[name="HourlyRate"]');
            const totalAmountElement = document.getElementById('totalAmount');
            const calculationText = document.getElementById('calculationText');
            const fileInput = document.getElementById('fileInput');
            const dropZone = document.getElementById('dropZone');
            const fileList = document.getElementById('fileList');

            // Check if elements exist before adding event listeners
            if (hoursInput && rateInput) {
                // Real-time calculation
                function calculateTotal() {
                    const hours = parseFloat(hoursInput.value) || 0;
                    const rate = parseFloat(rateInput.value) || 0;
                    const total = hours * rate;

                    if (totalAmountElement) {
                        totalAmountElement.textContent = total.toFixed(2);
                    }
                    if (calculationText) {
                        calculationText.textContent = `${hours} hours × R${rate.toFixed(2)}/hr`;
                    }
                }

                hoursInput.addEventListener('input', calculateTotal);
                rateInput.addEventListener('input', calculateTotal);

                // Initialize calculation
                calculateTotal();
            }

            // File upload handling
            if (dropZone && fileInput) {
                dropZone.addEventListener('click', () => fileInput.click());

                dropZone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    dropZone.classList.add('border-primary-400', 'bg-blue-50');
                });

                dropZone.addEventListener('dragleave', () => {
                    dropZone.classList.remove('border-primary-400', 'bg-blue-50');
                });

                dropZone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    dropZone.classList.remove('border-primary-400', 'bg-blue-50');
                    const files = e.dataTransfer.files;
                    handleFiles(files);
                });

                fileInput.addEventListener('change', (e) => {
                    handleFiles(e.target.files);
                });
            }

            function handleFiles(files) {
                if (files.length > 0 && fileList) {
                    fileList.classList.remove('hidden');
                    fileList.innerHTML = '';

                    Array.from(files).forEach(file => {
                        if (file.size > 5 * 1024 * 1024) {
                            if (typeof showToast === 'function') {
                                showToast('File too large: ' + file.name, 'error');
                            }
                            return;
                        }

                        const fileElement = document.createElement('div');
                        fileElement.className = 'flex items-center justify-between p-3 bg-green-50 rounded-lg border border-green-200';
                        fileElement.innerHTML = `
                            <div class="flex items-center space-x-3">
                                <i class="fas fa-file text-green-600"></i>
                                <span class="text-sm font-medium text-gray-700">${file.name}</span>
                                <span class="text-xs text-gray-500">(${(file.size / 1024 / 1024).toFixed(2)} MB)</span>
                            </div>
                            <button type="button" onclick="removeFile(this)" class="text-red-500 hover:text-red-700 transition-colors duration-200">
                                <i class="fas fa-times"></i>
                            </button>
                        `;
                        fileList.appendChild(fileElement);
                    });
                }
            }

            // Add animation delays
            const slideUpElements = document.querySelectorAll('.slide-up');
            slideUpElements.forEach((el, index) => {
                el.style.animationDelay = `${index * 0.1}s`;
            });
        });

        // Clear form function
        window.clearForm = function() {
            if (confirm('Are you sure you want to clear the form? All entered data will be lost.')) {
                const form = document.getElementById('claimForm');
                const fileList = document.getElementById('fileList');

                if (form) form.reset();
                if (fileList) {
                    fileList.classList.add('hidden');
                    fileList.innerHTML = '';
                }

                // Recalculate total
                const hoursInput = document.querySelector('input[name="HoursWorked"]');
                const rateInput = document.querySelector('input[name="HourlyRate"]');
                if (hoursInput && rateInput) {
                    hoursInput.dispatchEvent(new Event('input'));
                }

                if (typeof showToast === 'function') {
                    showToast('Form cleared', 'info');
                }
            }
        };

        // Remove file function
        window.removeFile = function(button) {
            const fileElement = button.closest('div');
            const fileList = document.getElementById('fileList');

            if (fileElement) fileElement.remove();

            if (fileList && fileList.children.length === 0) {
                fileList.classList.add('hidden');
            }
        };

        // Local showToast function as fallback
        function showToast(message, type = 'info') {
            // Use global showToast if available, otherwise use local implementation
            if (window.showToast && window.showToast !== showToast) {
                window.showToast(message, type);
                return;
            }

            const toast = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500';

            toast.className = `fixed top-4 right-4 ${bgColor} text-white px-6 py-3 rounded-xl shadow-lg transform translate-x-full transition-transform duration-300 z-50`;
            toast.innerHTML = `
                <div class="flex items-center space-x-3">
                    <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation-triangle' : 'info'}"></i>
                    <span>${message}</span>
                </div>
            `;

            document.body.appendChild(toast);

            // Animate in
            setTimeout(() => {
                toast.classList.remove('translate-x-full');
            }, 100);

            // Animate out and remove
            setTimeout(() => {
                toast.classList.add('translate-x-full');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.remove();
                    }
                }, 300);
            }, 3000);
        }
    </script>
}